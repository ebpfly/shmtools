# LADPackage Full Active Sensing

## Overview

This directory contains the Python implementation of the LADPackage Full Active Sensing workflow, converted from the original MATLAB mFUSE auto-generated script.

## Status: âœ… COMPLETED

Successfully implemented all required functions and created a functional Jupyter notebook that demonstrates the complete active sensing pipeline for structural damage detection using guided waves.

## Files

- `full_active_sensing.ipynb` - Main Jupyter notebook demonstrating the workflow
- `full_active_sensing.html` - Executed HTML output (305KB) with embedded plots
- `active_sensing_utils.py` - LADPackage-specific utility functions
- `data/data_example_ActiveSense.mat` - Example dataset with guided wave measurements

## Implementation Details

### Functions Implemented

1. **`import_active_sense_data()`** - Loads baseline and test waveforms, sensor layouts, and structure geometry
2. **`process_active_sensing_waveforms()`** - Performs baseline subtraction and matched filtering
3. **`arrival_filter()`** - Maximum likelihood estimation of guided wave arrival times
4. **`map_active_sensing_geometry()`** - Maps processed signals to structural geometry
5. **`plot_as_result()`** - Visualizes damage localization image with sensor positions

### Key Features

- **Baseline Subtraction**: Removes undamaged state to highlight changes
- **Matched Filtering**: Enhances signal-to-noise ratio using excitation waveform
- **Arrival Time Detection**: Uses statistical methods to identify wave arrivals
- **Geometric Mapping**: Projects time-of-flight data onto 2D structural geometry
- **Damage Imaging**: Creates heat maps showing likely damage locations

## Usage

```python
# Import the module
from LADPackage.active_sensing.active_sensing_utils import (
    import_active_sense_data,
    process_active_sensing_waveforms,
    arrival_filter,
    map_active_sensing_geometry,
    plot_as_result
)

# Load data
waveform_base, waveform_test, sensor_layout, pair_list, border_struct, sample_rate, actuation_waveform, damage_location = import_active_sense_data()

# Process waveforms
filter_result, layout_subset, pair_subset = process_active_sensing_waveforms(
    sensor_subset, sensor_layout, pair_list, 
    waveform_base, waveform_test, actuation_waveform
)

# Apply arrival filter
filtered_waveforms = arrival_filter(filter_result, front_clip=450, arrival_offset=450)

# Map to geometry (simplified version)
x_matrix, y_matrix, combined_matrix, data_map_2d = map_active_sensing_geometry(
    velocity=66000, subset_window=None, distance_allowance=np.inf,
    border_struct=border_struct, x_spacing=None, y_spacing=None,
    sample_rate=sample_rate, offset=actuation_waveform,
    data=filtered_waveforms, pair_list=pair_subset, 
    sensor_layout=layout_subset
)

# Visualize results
plot_as_result(x_matrix, y_matrix, data_map_2d, combined_matrix, layout_subset)
```

## Technical Notes

### Challenges Overcome

1. **MATLAB Structure Conversion**: Handled complex nested MATLAB structures containing border definitions
2. **Border Format Translation**: Converted 4xN line segment format to polygon vertices
3. **Grid Building Simplification**: Implemented simplified grid generation for computational efficiency
4. **Function Interdependencies**: Successfully integrated 10+ sub-functions from core shmtools library

### Simplifications Made

- **Grid Containment**: Uses bounding box instead of full polygon containment testing
- **Border Processing**: Simplified handling of inside/outside border definitions
- **Distance Filtering**: Basic implementation of propagation distance constraints

## Results

The implementation successfully:
- Loads and processes guided wave data from 31 piezoelectric sensors
- Performs signal processing with matched filtering
- Detects arrival times using maximum likelihood estimation
- Creates damage localization images
- Generates 305KB HTML output with embedded visualizations

## References

Flynn EB, Todd MD, Wilcox PD, Drinkwater BW, Croxford AJ. Maximum-likelihood estimation of damage location in guided-wave structural health monitoring. Proceedings of the Royal Society A, 2011.

## Original MATLAB Source

Converted from: `matlab/LADPackage/Demos/FullActiveSensing.m`  
Auto-Generated by mFUSE on 3/19/2016  
Python Conversion: 2025